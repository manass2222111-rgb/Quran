Commit changes            const [selectedVerse, setSelectedVerse] = React.useState(null);

            React.useEffect(() => {
                const initApp = async () => {
                    setLoading(true);
                    try {
                        const response = await fetch('https://api.alquran.cloud/v1/surah');
                        const data = await response.json();
                        if (data.code === 200) {
                            setSurahs(data.data);
                            const lastRead = localStorage.getItem('q_lastRead');
                            if (lastRead) {
                                const { surahNumber, verseNumber } = JSON.parse(lastRead);
                                await loadSurah(surahNumber, verseNumber);
                            } else {
                                setLoading(false);
                            }
                        } else throw new Error('فشل جلب القائمة');
                    } catch (err) {
                        setError('تأكد من الاتصال بالإنترنت');
                        setLoading(false);
                    }
                };
                initApp();
            }, []);

            React.useEffect(() => { localStorage.setItem('q_fontSize', fontSize); }, [fontSize]);
            React.useEffect(() => { 
                localStorage.setItem('q_darkMode', darkMode); 
                document.querySelector('meta[name="theme-color"]').setAttribute('content', darkMode ? '#0f172a' : '#fdfbf7');
            }, [darkMode]);

            const loadSurah = async (number, scrollToVerse = null) => {
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(`https://api.alquran.cloud/v1/surah/${number}/quran-uthmani`);
                    const data = await response.json();
                    if (data.code === 200) {
                        setCurrentSurah(data.data);
                        setView('reader');
                        if (!scrollToVerse) {
                            saveProgress(number, null);
                            setSelectedVerse(null);
                        } else {
                            setSelectedVerse(scrollToVerse);
                            setTimeout(() => {
                                const element = document.getElementById(`ayah-${scrollToVerse}`);
                                if (element) element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }, 500);
                        }
                    } else throw new Error();
                } catch (err) {
                    setError('حدث خطأ في التحميل');
                } finally {
                    setLoading(false);
                }
            };

            const saveProgress = (surahNum, verseNum) => {
                localStorage.setItem('q_lastRead', JSON.stringify({ surahNumber: surahNum, verseNumber: verseNum }));
            };

            const handleVerseClick = (verseNum) => {
                setSelectedVerse(verseNum);
                if (currentSurah) saveProgress(currentSurah.number, verseNum);
            };

            const theme = {
                bg: darkMode ? 'bg-slate-950' : 'bg-[#fdfbf7]',
                text: darkMode ? 'text-[#e2e8f0]' : 'text-black',
                headerBg: darkMode ? 'bg-slate-900 border-slate-800' : 'bg-[#f4efe4] border-[#e6ded1]',
                cardBg: darkMode ? 'bg-slate-800 hover:bg-slate-700 border-slate-700' : 'bg-white hover:bg-[#fcfaf5] border-[#eae5d8]',
                accent: darkMode ? 'text-emerald-400' : 'text-[#006400]',
                numberBadge: darkMode ? 'bg-slate-700 text-emerald-400' : 'bg-[#ebe5d5] text-black',
                verseNumber: darkMode ? 'text-emerald-400 border-emerald-800' : 'text-[#8a7e66] border-[#8a7e66]',
                button: darkMode ? 'bg-slate-800 hover:bg-slate-700' : 'bg-[#efeadd] hover:bg-[#e6dfcd] text-black',
                modalBg: darkMode ? 'bg-slate-900 border-slate-700' : 'bg-[#fdfbf7] border-[#dcd6c6]',
                highlight: darkMode ? 'bg-emerald-900/40 rounded' : 'bg-[#f4e4bc] rounded',
            };

            if (loading && !currentSurah && surahs.length === 0) {
                return (
                    <div className={`flex flex-col items-center justify-center h-screen w-full ${theme.bg} ${theme.text}`}>
                        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-current mb-4 opacity-50"></div>
                        <p className="font-amiri text-xl">جاري تحميل المصحف...</p>
                    </div>
                );
            }

            return (
                <div className={`flex flex-col h-screen w-full overflow-hidden transition-colors duration-300 font-sans ${theme.bg} ${theme.text}`}>
                    <header className={`flex items-center justify-between p-3 shadow-sm z-10 transition-colors ${theme.headerBg}`}>
                        <div className="flex items-center gap-2 flex-1">
                            {view === 'reader' && (
                                <button onClick={() => setView('list')} className="p-2 rounded-full hover:bg-black/5 active:scale-95 transition">
                                    <Icons.List size={24} className={theme.accent} />
                                </button>
                            )}
                            <button onClick={() => view === 'reader' && setView('list')} className={`text-xl font-bold font-tajawal flex items-center gap-2 px-2 py-1 rounded-lg ${view === 'reader' ? 'hover:bg-black/5' : ''} transition ${theme.accent}`}>
                                <Icons.Book size={20} />
                                {view === 'list' ? 'نور القرآن' : currentSurah?.name}
                                {view === 'reader' && <Icons.ChevronDown size={16} className="opacity-60" />}
                            </button>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setDarkMode(!darkMode)} className={`p-2 rounded-full transition ${darkMode ? 'hover:bg-slate-700 text-yellow-400' : 'hover:bg-[#e6dfcd] text-slate-600'}`}>
                                {darkMode ? <Icons.Sun size={20} /> : <Icons.Moon size={20} />}
                            </button>
                            {view === 'reader' && (
                                <button onClick={() => setView(view === 'settings' ? 'reader' : 'settings')} className={`p-2 rounded-full transition ${darkMode ? 'hover:bg-slate-700' : 'hover:bg-[#e6dfcd]'}`}>
                                    <Icons.Settings size={20} className={theme.text} />
                                </button>
                            )}
                        </div>
                    </header>

                    <main className="flex-1 overflow-y-auto scrollbar-hide relative">
                        {error && (
                            <div className="flex flex-col items-center justify-center h-full p-6 text-center">
                                <p className="text-red-400 mb-4 font-tajawal">{error}</p>
                                <button onClick={() => window.location.reload()} className="flex items-center gap-2 px-6 py-2 bg-emerald-600 text-white rounded-full hover:bg-emerald-700 font-tajawal shadow-lg">
                                    <Icons.RotateCcw size={18} /> إعادة التحميل
                                </button>
                            </div>
                        )}

                        {view === 'list' && !error && (
                            <div className="p-3 grid grid-cols-1 gap-3 pb-20">
                                {surahs.map((surah) => (
                                    <button key={surah.number} onClick={() => loadSurah(surah.number)} className={`flex items-center justify-between p-4 rounded-xl transition-all border shadow-sm active:scale-95 ${theme.cardBg}`}>
                                        <div className="flex items-center gap-3">
                                            <span className={`flex items-center justify-center w-9 h-9 rounded-full text-base font-bold font-tajawal ${theme.numberBadge}`}>{toArabicNumerals(surah.number)}</span>
                                            <div className="text-right">
                                                <span className="block text-xl font-amiri font-bold">{surah.name}</span>
                                                <span className="text-xs opacity-70 font-tajawal">{surah.englishNameTranslation} • {toArabicNumerals(surah.numberOfAyahs)} آية</span>
                                            </div>
                                        </div>
                                        <div className="text-xs px-2 py-1 rounded-md bg-black/5 opacity-70">{surah.revelationType === 'Meccan' ? 'مكية' : 'مدنية'}</div>
                                    </button>
                                ))}
                            </div>
                        )}

                        {view === 'reader' && currentSurah && (
                            <div className="pb-32">
                                {currentSurah.number !== 9 && (
                                    <div className="text-center py-8"><p className={`font-amiri text-2xl ${theme.accent}`}>بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ</p></div>
                                )}
                                <div className="px-4 text-justify leading-[2.4] no-select" style={{ fontSize: `${fontSize}px` }}>
                                    {currentSurah.ayahs.map((ayah, index) => {
                                        let text = ayah.text;
                                        if (currentSurah.number !== 1 && index === 0 && text.startsWith("بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ")) {
                                            text = text.replace("بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ", "").trim();
                                        }
                                        return (
                                            <span key={ayah.number} id={`ayah-${ayah.numberInSurah}`} onClick={() => handleVerseClick(ayah.numberInSurah)} className={`font-amiri inline cursor-pointer transition-colors duration-200 px-0.5 rounded ${selectedVerse === ayah.numberInSurah ? theme.highlight : ''}`}>
                                                {text} <span className={`inline-flex items-center justify-center mx-1 h-[0.9em] w-[0.9em] border border-current rounded-full text-[0.55em] align-middle ${theme.verseNumber}`}>{toArabicNumerals(ayah.numberInSurah)}</span> 
                                            </span>
                                        );
                                    })}
                                </div>
                                <div className="flex justify-between items-center px-4 mt-10 py-6 gap-4">
                                    <button onClick={() => currentSurah.number < 114 && loadSurah(currentSurah.number + 1)} disabled={currentSurah.number === 114} className={`flex-1 py-4 rounded-xl flex items-center justify-center gap-2 font-tajawal font-bold transition shadow-sm ${currentSurah.number === 114 ? 'opacity-50' : theme.button}`}>
                                        <Icons.ChevronRight size={20} /> السورة التالية
                                    </button>
                                    <button onClick={() => currentSurah.number > 1 && loadSurah(currentSurah.number - 1)} disabled={currentSurah.number === 1} className={`flex-1 py-4 rounded-xl flex items-center justify-center gap-2 font-tajawal font-bold transition shadow-sm ${currentSurah.number === 1 ? 'opacity-50' : theme.button}`}>
                                        السورة السابقة <Icons.ChevronLeft size={20} />
                                    </button>
                                </div>
                            </div>
                        )}

                        {view === 'settings' && (
                            <div className="absolute inset-0 z-20 bg-black/40 backdrop-blur-[2px] flex items-end justify-center sm:items-center p-4">
                                <div className={`w-full max-w-md p-6 rounded-2xl shadow-2xl border mb-10 sm:mb-0 ${theme.modalBg}`}>
                                    <div className="flex justify-between items-center mb-6">
                                        <h3 className="text-lg font-bold font-tajawal">إعدادات القراءة</h3>
                                        <button onClick={() => setView('reader')} className="text-red-500 font-bold px-3 py-1">إغلاق</button>
                                    </div>
                                    <div className="mb-6">
                                        <label className="flex items-center gap-2 mb-4 text-sm font-tajawal opacity-70"><Icons.Type size={18} /> حجم الخط</label>
                                        <div className="flex items-center gap-4">
                                            <button onClick={() => setFontSize(Math.max(16, fontSize - 2))} className={`w-12 h-12 rounded-xl flex items-center justify-center font-bold text-xl shadow-sm ${theme.button}`}>-</button>
                                            <span className="flex-1 text-center font-bold text-2xl font-amiri">{toArabicNumerals(fontSize)}</span>
                                            <button onClick={() => setFontSize(Math.min(70, fontSize + 2))} className={`w-12 h-12 rounded-xl flex items-center justify-center font-bold text-xl shadow-sm ${theme.button}`}>+</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

